"use strict";System.register(["app/plugins/sdk","lodash","app/core/utils/kbn","jquery","./libs/echarts.min","./libs/dark","./style.css!","./libs/bmap.js","./libs/getBmap.js","./data_processor","./data_formatter"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f,g,h,i,j,k,l,m,n;return{setters:[function(a){f=a.MetricsPanelCtrl},function(a){g=a["default"]},function(a){h=a["default"]},function(a){i=a["default"]},function(a){j=a["default"]},function(a){},function(a){},function(a){},function(a){},function(a){k=a.DataProcessor},function(a){l=a["default"]}],execute:function(){m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Controller",n=function(a){function b($scope,$injector){c(this,b);var a=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,$scope,$injector)),e={IS_UCD:!1,METHODS:["POST","GET"],ETYPE:["line","pie","map"],url:"",method:"POST",upInterval:6e4,format:"Year"};return e.setOption={legend:{show:!1,type:"plain",left:"auto",top:"bottom",align:"auto",orient:"horizontal",icon:"roundRect",data:[]},grid:{left:"10%",top:"60",right:"10%",bottom:"60",containLabel:!1},xAxis:[{type:"category",data:[],boundaryGap:!1,splitLine:{show:!1,lineStyle:{type:"solid",opacity:"0.3"}}}],yAxis:[{type:"value",splitLine:{show:!1,lineStyle:{type:"solid",opacity:"0.3"}}}],tooltip:{show:!1,trigger:"axis",axisPointer:{type:"line"}},toolbox:{show:!1,orient:"horizontal",feature:{magicType:{type:["line","bar","stack","tiled"]},restore:{}},left:"auto",top:"auto"},series:[],color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],animation:!1},e.spareOption={series:{type:[],smooth:[],stack:[],step:[],symbolSize:[],itemStyle:{normal:{lineStyle:{width:[]},areaStyle:{opacity:[]}}}}},g.defaults(a.panel,e),console.log(a.panel),a.dataFormatter=new l(a,h),a.processor=new k(a.panel),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataReceived.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("panel-initialized",a.render.bind(a)),a.refreshData(),a}return e(b,a),m(b,[{key:"onDataReceived",value:function(a){if(console.log(a),this.seriesList={dataList:a,xAxisOp:[],seriesOp:[]},"Year"===this.panel.format)this.seriesList.xAxisOp=["1/1","2/1","3/1","4/1","5/1","6/1","7/1","8/1","9/1","10/1","11/1","12/1"];else if("Month"===this.panel.format)this.seriesList.xAxisOp=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"];else if("Week"===this.panel.format)this.seriesList.xAxisOp=["Mon","Tue","Wed","Thur","Fri","Sat","Sun"];else if("Day"===this.panel.format)this.seriesList.xAxisOp=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];else if("Custom-Year"===this.panel.format)for(var b in a[0].datapoints)this.seriesList.xAxisOp.push(new Date(a[0].datapoints[b][1]).getFullYear());else if("Custom-Month"===this.panel.format)for(var c in a[0].datapoints)this.seriesList.xAxisOp.push(new Date(a[0].datapoints[c][1]).getFullYear()+"-"+(new Date(a[0].datapoints[c][1]).getMonth()+1));else if("Custom-FullMonth"===this.panel.format){for(var d in a){var e=new Date(a[d].datapoints[0][1]).getFullYear(),f=new Date(a[d].datapoints[0][1]).getMonth();if(0!==f)for(var g=f-1;g>=0;g--)a[d].datapoints.unshift([0,new Date(e+"/"+(g+1)+"/1").getTime()]);if(a[d].datapoints.length<12)for(var h=a[d].datapoints.length,i=h;i<12;i++)a[d].datapoints.push([0,new Date(e+"/"+(i+1)+"/1").getTime()])}for(var j in a[0].datapoints)this.seriesList.xAxisOp.push(new Date(a[0].datapoints[j][1]).getFullYear()+"-"+(new Date(a[0].datapoints[j][1]).getMonth()+1));console.log(a)}for(var k in a){void 0==this.panel.spareOption.series.type[k]&&(this.panel.spareOption.series.type[k]="line"),void 0==this.panel.spareOption.series.smooth[k]&&(this.panel.spareOption.series.smooth[k]=!1),void 0==this.panel.spareOption.series.stack[k]&&(this.panel.spareOption.series.stack[k]=!1),void 0==this.panel.spareOption.series.step[k]&&(this.panel.spareOption.series.step[k]=!1),void 0==this.panel.spareOption.series.symbolSize[k]&&(this.panel.spareOption.series.symbolSize[k]=4),void 0==this.panel.spareOption.series.itemStyle.normal.lineStyle.width[k]&&(this.panel.spareOption.series.itemStyle.normal.lineStyle.width[k]=1),void 0==this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[k]&&(this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[k]=0);var l={name:a[k].target,type:this.panel.spareOption.series.type[k],smooth:this.panel.spareOption.series.smooth[k],stack:this.panel.spareOption.series.stack[k],step:this.panel.spareOption.series.step[k],symbolSize:this.panel.spareOption.series.symbolSize[k],itemStyle:{normal:{lineStyle:{width:this.panel.spareOption.series.itemStyle.normal.lineStyle.width[k]},areaStyle:{opacity:this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[k]}}},data:[]};this.seriesList.seriesOp.push(l);for(var m in a[k].datapoints)this.seriesList.seriesOp[k].data.push(a[k].datapoints[m][0])}this.refreshed=!0,this.render(),this.refreshed=!1}},{key:"xAxis",value:function(a){}},{key:"onDataError",value:function(a){this.series=[],this.render()}},{key:"onInitEditMode",value:function(){this.addEditorTab("Option","public/plugins/advantech-ushop-cross-time-graph/partials/options.html",2)}},{key:"refreshColor",value:function(a){console.log(a),console.log(this.panel.setOption.color)}},{key:"refreshData",value:function(){var a=this,b=this,c=void 0;c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b.customizeData=JSON.parse(c.responseText),b.onDataReceived())},this.panel.IS_UCD?(c.open(b.panel.method,b.panel.url,!0),c.send()):c=null,this.$timeout(function(){a.refreshData()},b.panel.upInterval)}},{key:"link",value:function(a,b,c,d){function e(){var a=d.height||panel.height||d.row.height;g.isString(a)&&(a=parseInt(a.replace("px",""),10)),a+=0,h.style.height=a+"px"}function f(){if(i&&(e(),i.resize(),d.refreshed)){i.clear(),void 0!==d.seriesList?(d.panel.setOption.xAxis[0].data=d.seriesList.xAxisOp,d.panel.setOption.series=d.seriesList.seriesOp):(d.panel.setOption.xAxis[0].data=[],d.panel.setOption.series=[]),d.panel.setOption.legend.data=[];for(var a in d.panel.setOption.series)d.panel.setOption.legend.data.push(d.panel.setOption.series[a].name);i.setOption(d.panel.setOption)}}var h=b.find(".echarts_container")[0];d.refreshed=!0,e();var i=j.init(h,"dark");setTimeout(function(){i.resize()},1e3),this.events.on("render",function(){f(),d.renderingCompleted()})}}]),b}(f)),a("Controller",n),n.templateUrl="partials/module.html"}}});
//# sourceMappingURL=controller.js.map