"use strict";System.register(["lodash","./geohash","./china_city_mapping"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a["default"]},function(a){e=a["default"]},function(a){f=a["default"]}],execute:function(){g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(){function a(b,d){c(this,a),this.ctrl=b,this.kbn=d}return g(a,[{key:"setValues",value:function(a){var b=this;if(this.ctrl.series&&this.ctrl.series.length>0){var c=0,e=Number.MAX_VALUE;this.ctrl.series.forEach(function(f){var g=d.last(f.datapoints),h=d.isArray(g)?g[0]:null,i=d.find(b.ctrl.locations,function(a){return a.key.toUpperCase()===f.alias.toUpperCase()});if(i)if(d.isString(h))a.push({key:f.alias,value:0,valueFormatted:h,valueRounded:0});else{var j={key:f.alias,locationName:i.name,locationLatitude:i.latitude,locationLongitude:i.longitude,value:f.stats[b.ctrl.panel.valueName],valueFormatted:h,valueRounded:0};j.value>c&&(c=j.value),j.value<e&&(e=j.value),j.valueRounded=b.kbn.roundValue(j.value,parseInt(b.ctrl.panel.decimals,10)||0),a.push(j)}}),a.highestValue=c,a.lowestValue=e,a.valueRange=c-e}}},{key:"setGeohashValues",value:function(a,b){var c=this;if(this.ctrl.panel.esGeoPoint&&this.ctrl.panel.esMetric&&a&&a.length>0){var d=0,g=Number.MAX_VALUE;console.info("setGeohashValues..."),a[0].datapoints.forEach(function(a){var h=a[c.ctrl.panel.esGeoPoint],i=(e(h),{name:c.ctrl.panel.esLocationName?f(a[c.ctrl.panel.esLocationName]):h,value:a[c.ctrl.panel.esMetric]});i.value>d&&(d=i.value),i.value<g&&(g=i.value),i.valueRounded=c.kbn.roundValue(i.value,c.ctrl.panel.decimals||0),b.push(i)}),b.highestValue=d,b.lowestValue=g,b.valueRange=d-g}}},{key:"setTableValues",value:function(a,b){var c=this;if(a&&a.length>0){var d=0,f=Number.MAX_VALUE;a[0].forEach(function(a){if(a.geohash){var g=a.geohash,h=e(g),i={key:g,locationName:a[c.ctrl.panel.tableLabel]||"n/a",locationLatitude:h.latitude,locationLongitude:h.longitude,value:a.metric,valueFormatted:a.metric,valueRounded:0};i.value>d&&(d=i.value),i.value<f&&(f=i.value),i.valueRounded=c.kbn.roundValue(i.value,c.ctrl.panel.decimals||0),b.push(i)}}),b.highestValue=d,b.lowestValue=f,b.valueRange=d-f}}},{key:"aggByProvince",value:function(a){if(!a||0==a.length)return[];var b=function(a,b){return a+=b.value},c=d.chain(a).groupBy("name").map(function(a,c){return{name:c,value:d.reduce(a,b,0)}}).value();return c}}],[{key:"tableHandler",value:function(a){var b=[];if("table"===a.type){var c={};a.columns.forEach(function(a,b){c[b]=a.text}),a.rows.forEach(function(a){var d={};a.forEach(function(a,b){var e=c[b];d[e]=a}),b.push(d)})}return b}}]),a}(),a("default",h)}}});
//# sourceMappingURL=data_formatter.js.map