"use strict";System.register(["lodash","./geohash"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a["default"]},function(a){e=a["default"]}],execute:function(){f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(){function a(b,d){c(this,a),this.ctrl=b,this.kbn=d}return f(a,[{key:"setValues",value:function(a){var b=this;if(this.ctrl.series&&this.ctrl.series.length>0){var c=0,e=Number.MAX_VALUE;this.ctrl.series.forEach(function(f){var g=d.last(f.datapoints),h=d.isArray(g)?g[0]:null,i=d.find(b.ctrl.locations,function(a){return a.key.toUpperCase()===f.alias.toUpperCase()});if(i)if(d.isString(h))a.push({key:f.alias,value:0,valueFormatted:h,valueRounded:0});else{var j={key:f.alias,locationName:i.name,locationLatitude:i.latitude,locationLongitude:i.longitude,value:f.stats[b.ctrl.panel.valueName],valueFormatted:h,valueRounded:0};j.value>c&&(c=j.value),j.value<e&&(e=j.value),j.valueRounded=b.kbn.roundValue(j.value,parseInt(b.ctrl.panel.decimals,10)||0),a.push(j)}}),a.highestValue=c,a.lowestValue=e,a.valueRange=c-e}}},{key:"createDataValue",value:function(a,b,c,d){var e={key:a,locationName:c,locationLatitude:b.latitude,locationLongitude:b.longitude,value:d,valueFormatted:d,valueRounded:0};return e.valueRounded=this.kbn.roundValue(e.value,this.ctrl.panel.decimals||0),e}},{key:"setGeohashValues",value:function(a,b){var c=this;if(this.ctrl.panel.esGeoPoint&&this.ctrl.panel.esMetric&&a&&a.length>0){var d=0,f=Number.MAX_VALUE;a.forEach(function(a){if("table"===a.type){var g={};a.columns.forEach(function(a,b){g[a.text]=b}),a.rows.forEach(function(a){var h=a[g[c.ctrl.panel.esGeoPoint]],i=e(h),j=c.ctrl.panel.esLocationName?a[g[c.ctrl.panel.esLocationName]]:h,k=a[g[c.ctrl.panel.esMetric]],l=c.ctrl.panel.linkData,m=c.createDataValue(h,i,j,k,l,d,f);m.value>d&&(d=m.value),m.value<f&&(f=m.value),b.push(m)}),b.highestValue=d,b.lowestValue=f,b.valueRange=d-f}else a.datapoints.forEach(function(a){var g=a[c.ctrl.panel.esGeoPoint],h=e(g),i=c.ctrl.panel.esLocationName?a[c.ctrl.panel.esLocationName]:g,j=a[c.ctrl.panel.esMetric],k=c.ctrl.panel.linkData,l=c.createDataValue(g,h,i,j,k,d,f);l.value>d&&(d=l.value),l.value<f&&(f=l.value),b.push(l)}),b.highestValue=d,b.lowestValue=f,b.valueRange=d-f})}}},{key:"setTableValues",value:function(a,b){var c=this;if(a&&a.length>0){var d=0,f=Number.MAX_VALUE;a[0].forEach(function(a){var g={};if(a.geohash){var h=a.geohash,i=e(h);g={key:h,locationName:a[c.ctrl.panel.tableLabel]||"n/a",locationLatitude:i.latitude,locationLongitude:i.longitude,value:a.metric,valueFormatted:a.metric,valueRounded:0}}else{if(!a.latitude||!a.longitude)return;g={key:a.hostname,locationName:a[c.ctrl.panel.tableLabel]||"n/a",locationLatitude:a.latitude,locationLongitude:a.longitude,value:a.metric,valueFormatted:a.metric,valueRounded:0}}g.value>d&&(d=g.value),g.value<f&&(f=g.value),g.valueRounded=c.kbn.roundValue(g.value,c.ctrl.panel.decimals||0),b.push(g)}),b.highestValue=d,b.lowestValue=f,b.valueRange=d-f}}},{key:"setJsonValues",value:function(a){if(this.ctrl.series&&this.ctrl.series.length>0){var b=0,c=Number.MAX_VALUE;this.ctrl.series.forEach(function(d){var e={key:d.key,locationName:d.name,locationLatitude:d.latitude,locationLongitude:d.longitude,value:void 0!==d.value?d.value:1,valueRounded:0};e.value>b&&(b=e.value),e.value<c&&(c=e.value),e.valueRounded=Math.round(e.value),a.push(e)}),a.highestValue=b,a.lowestValue=c,a.valueRange=b-c}}},{key:"setJsonScada",value:function(a){if(this.ctrl.series&&this.ctrl.series.length>0){for(var b=0,c=Number.MAX_VALUE,d=0;d<this.ctrl.series.length;d++){var e=this.ctrl.panel.targets[d].hostname,f=this.ctrl.panel.targets[d].latitude,g=this.ctrl.panel.targets[d].longitude,h=this.ctrl.panel.targets[d].hostname;h+="_",h+=f,h+="_",h+=g,h+="_"+this.ctrl.series[d].target;var i=this.ctrl.series[d].datapoints;if(i&&i.length>0){var j=i[i.length-1];if(j&&j.length>0){var k={key:h,locationName:e,locationLatitude:f,locationLongitude:g,value:j[0],valueRounded:0};k.value>b&&(b=k.value),k.value<c&&(c=k.value),k.valueRounded=Math.round(k.value),a.push(k)}}}a.highestValue=b,a.lowestValue=c,a.valueRange=b-c}}},{key:"setJsonRMM",value:function(a){if(this.ctrl.series&&this.ctrl.series.length>0){for(var b=0,c=Number.MAX_VALUE,d=0;d<this.ctrl.series.length;d++){var e=this.ctrl.series[d].target.split("|")[0],f=this.ctrl.series[d].latitude,g=this.ctrl.series[d].longitude,h=this.ctrl.series[d].target,i=this.ctrl.series[d].datapoints;if(i&&i.length>0){var j=i[i.length-1];if(j&&j.length>0){var k={key:h,locationName:e,locationLatitude:f,locationLongitude:g,value:j[0],valueRounded:0};k.value>b&&(b=k.value),k.value<c&&(c=k.value),k.valueRounded=Math.round(k.value),a.push(k)}}}a.highestValue=b,a.lowestValue=c,a.valueRange=b-c}}}],[{key:"tableHandler",value:function(a){var b=[];if("table"===a.type){var c={};a.columns.forEach(function(a,b){c[b]=a.text}),a.rows.forEach(function(a){var d={};a.forEach(function(a,b){var e=c[b];d[e]=a}),b.push(d)})}return b}}]),a}(),a("default",g)}}});
//# sourceMappingURL=data_formatter.js.map