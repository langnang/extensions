"use strict";System.register(["app/plugins/sdk","lodash","app/core/utils/kbn","jquery","./libs/echarts.min","./libs/dark","./style.css!","./data_processor","./data_formatter"],function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f,g,h,i,j,k,l,m,n;return{setters:[function(a){f=a.MetricsPanelCtrl},function(a){g=a["default"]},function(a){h=a["default"]},function(a){i=a["default"]},function(a){j=a["default"]},function(a){},function(a){},function(a){k=a.DataProcessor},function(a){l=a["default"]}],execute:function(){m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Controller",n=function(a){function b($scope,$injector){c(this,b),console.log("constructor");var a=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,$scope,$injector)),e={IS_UCD:!1,METHODS:["POST","GET"],ETYPE:["line","pie","map"],url:"",method:"POST",upInterval:6e4,format:"Year",subTabKey:"default",dataTabIndex:0,echarts:{type:"Scatter",typeList:["line","bar","scatter"],chart:"Basic Scatter Chart",chartList:[],reserveOption:{xAxis:{show:!0,option:{show:!0},typeList:[],dataFormat:{"ww/dd":[],"mm/dd":[],"yyyy/mm":[]}},yAxis:{show:!0,typeList:[],dataFormat:{}},series:{typeList:["line"]}},seriesData:[],scatterDefault:{data:[],type:"scatter",refId:""},option:{color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],grid:{},legend:{show:!1,data:[]},tooltip:{show:!0,trigger:"item",axisPointer:{type:"line"},textStyle:{color:"#ececec",fontSize:7,lineHeight:25},backgroundColor:"rgba(20,20,20,0.9)",padding:[10,13]},xAxis:{splitLine:{show:!1},name:"",nameLocation:"middle"},yAxis:{splitLine:{show:!1},name:"",nameLocation:"middle"},series:[]}}};return g.defaults(a.panel,e),a.dataFormatter=new l(a,h),a.processor=new k(a.panel),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataReceived.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("panel-initialized",a.render.bind(a)),a.refreshData(),a}return e(b,a),m(b,[{key:"onDataReceived",value:function(a){var b=this;g.forEach(a,function(a,c){if("table"!==a.type)console.log("type Error");else{var d=b.panel.echarts.scatterDefault,e=[];g.forEach(a.rows,function(a,b){e.push([a[0],a[1]])}),void 0==b.panel.echarts.option.series[c]&&(b.panel.echarts.option.series[c]={}),b.panel.echarts.option.series[c].type=d.type,b.panel.echarts.option.series[c].data=e,b.panel.echarts.option.series[c].refId=a.refId,b.panel.echarts.option.series[c].label=d.label,b.panel.echarts.option.series[c].markLine=b.panel.echarts.option.series[c].markLine?b.panel.echarts.option.series[c].markLine:{show:!1},b.panel.echarts.option.series[c].markLine.show?void 0==b.panel.echarts.option.series[c].markLine.data?b.panel.echarts.option.series[c].markLine={show:!0,data:[{xAxis:""},{yAxis:""}],itemStyle:{normal:{label:{show:!1}}},lineStyle:{normal:{type:"solid"}},tooltip:{show:!1},symbol:["none","none"]}:(b.panel.echarts.option.series[c].markLine.symbol=[b.panel.echarts.option.series[c].markLine.symbol[0]?b.panel.echarts.option.series[c].markLine.symbol[0]:"none",b.panel.echarts.option.series[c].markLine.symbol[1]?b.panel.echarts.option.series[c].markLine.symbol[1]:"none"],b.panel.echarts.option.series[c].markLine.data=[{xAxis:b.panel.echarts.option.series[c].markLine.data[0].xAxis?b.panel.echarts.option.series[c].markLine.data[0].xAxis:""},{yAxis:b.panel.echarts.option.series[c].markLine.data[1].yAxis?b.panel.echarts.option.series[c].markLine.data[1].yAxis:""}]):b.panel.echarts.option.series[c].markLine={show:!1},b.panel.echarts.option.legend.data[c]=b.panel.echarts.option.series[c].name?b.panel.echarts.option.series[c].name:""}}),this.rebuildTooltips(),this.refreshed=!0,this.render(),this.refreshed=!1}},{key:"rebuildTooltips",value:function(){var a=this.panel.echarts.option.xAxis.name,b=this.panel.echarts.option.yAxis.name;this.panel.echarts.option.tooltip.formatter=function(c){var d='<p style="margin-bottom:9px;font-weight:bold;">'+c.seriesName+"</p>";return d+=""===a&&""===b?"<b>"+c.value[0]+","+c.value[1]+"</b>":'<p style="margin-bottom:5px;"><small>'+a+":</small>&nbsp;&nbsp;&nbsp;&nbsp;<b>"+c.value[0]+'</b></p>\n        <p style="margin-bottom:0px;"><small>'+b+":</small>&nbsp;&nbsp;&nbsp;&nbsp;<b>"+c.value[1]+"</b></p>"}}},{key:"updateOption",value:function(){for(var a in this.panel.echarts.reserveOption)this.panel.echarts.reserveOption[a].show}},{key:"refreshEchartsTypeList",value:function(){console.group("refreshEchartsTypeList"),this.panel.echarts.typeList=[];for(var a in echartsOption())this.panel.echarts.typeList.push(g.toLower(a))}},{key:"rebuildDataList",value:function(){var a=[],b="";g.forEach(this.panel.echarts.seriesData,function(c,d){g.isUndefined(c.refId)?(c.refId="TEST",b=c.refId,a.push({refId:b,time:[]})):c.refId!==b&&(b=c.refId,a.push({refId:b,time:[]})),a[a.length-1].time=g.unzip(c.datapoints)[1],a[a.length-1][c.target]=c.datapoints}),this.panel.echarts.seriesData=a}},{key:"rebuildSeries",value:function(){for(var a=0;a<=this.panel.echarts.seriesData.length-1;a++)switch(g.isUndefined(this.panel.echarts.option.series[a])&&this.panel.echarts.option.series.push({type:this.panel.echarts.reserveOption.series.typeList[0],data:[],isRebuildOption:!1}),this.panel.echarts.option.series[a].refId=this.panel.echarts.seriesData[a].refId,this.panel.echarts.option.series[a].type){case"line":console.log(this.panel.echarts.seriesData[a]),this.panel.echarts.option.series[a].data=this.panel.echarts.seriesData[a].time}}},{key:"rebuildSeriesData",value:function(a){for(var b=[],c=0;c<=a.length-1;c++);return b}},{key:"forEachJSON",value:function(a,b){for(var c in a)b(a[c],c)}},{key:"addColor",value:function(){void 0==this.panel.echarts.option.color&&(this.panel.echarts.option.color=[]),this.panel.echarts.option.color.push(""),this.refresh()}},{key:"removeColor",value:function(){void 0!==this.panel.echarts.option.color&&this.panel.echarts.option.color.length>0&&this.panel.echarts.option.color.pop(),this.refresh()}},{key:"onDataError",value:function(a){this.render()}},{key:"onInitEditMode",value:function(){this.addEditorTab("Option","public/plugins/echarts-scatter-panel/partials/options.html",2),this.addEditorTab("Advanced","public/plugins/echarts-scatter-panel/partials/advanced.html",3)}},{key:"refreshData",value:function(){var a=this,b=this,c=void 0;c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b.customizeData=JSON.parse(c.responseText),b.onDataReceived())},this.panel.IS_UCD?(c.open(b.panel.method,b.panel.url,!0),c.send()):c=null,this.$timeout(function(){a.refreshData()},b.panel.upInterval)}},{key:"link",value:function(a,b,c,d){function e(){var a=d.height||panel.height||d.row.height;g.isString(a)&&(a=parseInt(a.replace("px",""),10)),a+=0,h.style.height=a+"px"}function f(){i&&(e(),i.resize(),d.refreshed&&(i.clear(),i.setOption(d.panel.echarts.option,!0)))}var h=b.find(".echarts_container")[0];d.refreshed=!0,e();var i=j.init(h,"dark");setTimeout(function(){i.resize()},1e3),this.events.on("render",function(){f(),d.renderingCompleted()})}}]),b}(f)),a("Controller",n),n.templateUrl="partials/module.html"}}});
//# sourceMappingURL=controller.js.map